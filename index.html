<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Project</title>
</head>
<body>
    <div class="heading">Make a List of Books You've Read or Are Reading:</div>
    <div class="bookgrid">
    </div>
    <div class="bookadd">Add A Book</div>
    <div class="formsuit">
        <div class="fsinner">
            <button class="close">Ã— Close</button>
            <form method="post" action="">
                <label for="author">Author</label>
                <input id="author" type="text" name="author" required/>
                <label for="title">Title</label>
                <input id="title" type="text" name="title" required/>
                <label for="length">Page Length</label>
                <input id="length" type="number" name="length" min=0 required/>
                <div class="radio-b">
                    <div>Status:</div>
                    <input class="has_start" type="radio" id="started" name="status" value="Started" required>
                    <label class="has_start" for="started">Started</label><br>
                    <input class="no_start" type="radio" id="not-started" name="status" value="Not Started" required checked="true">
                    <label class="no_start" for="not-started">Not Started</label><br>
                </div>
                <input type="submit">
            </form>
        </div>
    </div>
</body>
<style>
    .formsuit{
        position: fixed;
        background: rgba(0, 0, 0, 0.7);
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        display: none;
        z-index: 2;
    }
    .formsuit.open{
        display: grid;
        align-items: center;
        justify-items: center;
    }
    .fsinner{
        background: white;
        padding: 30px;
    }
    form{
        display: flex;
        flex-direction: column;
    }
</style>

<script>
    let myLibrary = [];
    
    function Book(input_arr){
        this.author = input_arr[0];
        this.title = input_arr[1];
        this.num_pages = input_arr[2];
        this.been_started = input_arr[3];
        this.curr_page = input_arr[4];
    }

    const bookgrid = document.querySelector('.bookgrid');
    const formsuit = document.querySelector('.formsuit');
    
    function bookDisplay(book){
            let authorCurr = document.createElement("div");
            authorCurr.textContent = `Author: ${book.author}`;
            authorCurr.classList.add('author');
            bookgrid.appendChild(authorCurr);

            let titleCurr = document.createElement("div");
            titleCurr.textContent = `Title: ${book.title}`;
            titleCurr.classList.add('title');
            bookgrid.appendChild(titleCurr);

            let lengthCurr = document.createElement("div");
            lengthCurr.textContent = `Page Length: ${book.num_pages}`;
            lengthCurr.classList.add('length');
            bookgrid.appendChild(lengthCurr);

            let startedCurr = document.createElement("div");
            startedCurr.textContent = `Status: ${book.been_started}`;
            startedCurr.classList.add('started');
            bookgrid.appendChild(startedCurr);

            let pageCurr = document.createElement("div");
            pageCurr.textContent = `Current Page: ${book.curr_page}`;
            pageCurr.classList.add('pagenum');
            bookgrid.appendChild(pageCurr);
            
            myLibrary.push(book);
        }

    const form = document.querySelector('form');
    form.addEventListener('submit', (e) => {
        e.preventDefault()
        let formData = new FormData(form);
        form.reset();
        let constructArgs = []
        for (const pair of formData.entries()) {
            constructArgs.push(pair[1])
        }
        if(constructArgs.length === 4){
            constructArgs.push(0);
        } else{
            form.removeChild(pageNumReq1);
            form.removeChild(pageNumReq2);  
        }
        bookDisplay(new Book(constructArgs));
        formsuit.classList.remove('open');
    });

    const startedButt = document.querySelectorAll('.has_start');
    const nostartButt = document.querySelectorAll('.no_start');

    const pageNumReq1 = document.createElement("label");
    pageNumReq1.setAttribute('for', "pagenum");
    pageNumReq1.textContent = "Current Page Number";

    const pageNumReq2 = document.createElement("input");
    pageNumReq2.setAttribute('id', "pagenum");
    pageNumReq2.setAttribute('type', "number");
    pageNumReq2.setAttribute('name', "current_page");
    pageNumReq2.setAttribute('min',0);
    pageNumReq2.setAttribute('oninput', "checkPages();")
    pageNumReq2.required = true;

    const radiob = document.querySelector('.radio-b');

    startedButt.forEach(area => area.addEventListener('click', function addpart(){
        radiob.after(pageNumReq1);
        pageNumReq1.after(pageNumReq2);
    }));

    nostartButt.forEach(area => area.addEventListener('click', function rempart(){
        form.removeChild(pageNumReq1);
        form.removeChild(pageNumReq2);
    }));

    const bookAdd = document.querySelector('.bookadd');
    bookAdd.addEventListener('click', ()=> formsuit.classList.add('open'));

    const closeButton = document.querySelector('.close');
    closeButton.addEventListener('click', ()=> formsuit.classList.remove('open'));
    
    window.addEventListener('keyup', function esc(e){
      if (e.keyCode == 27) formsuit.classList.remove('open');
    });

    window.addEventListener('click', function escape(e){
      if (e.target.classList.contains('formsuit') && e.target.classList.contains('open')) formsuit.classList.remove('open');
    });

    function checkPages(){
        if(parseInt(document.querySelector('#pagenum').value) > parseInt(document.querySelector('#length').value)){
            document.querySelector('#pagenum').setCustomValidity("Completed pages cannot be more than total pages.");
        } else{
            document.querySelector('#pagenum').setCustomValidity("");
        }
    }

</script>
</html>